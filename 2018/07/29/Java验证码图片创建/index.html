<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  <title>Java验证码图片创建 | 飞翔的傻瓜</title>
  <meta name="HandheldFriendly" content="True" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="shortcut icon" href="/">
  <link rel="alternate" href="/atom.xml" title="飞翔的傻瓜">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="baidu-site-verification" content="w8y9i0DLo1" />
  <meta name="google-site-verification" content="Hg65zzAhYoP1hnVohYgDSs2guJEZGLxOd7tenG74mQ4" />
  <link rel="shortcut icon" href="" />
  <link rel="icon" href="" />
  <link href="https://fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet">
  <link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href='//cdn.bootcss.com/node-waves/0.7.5/waves.min.css' rel='stylesheet'>
  <link rel="stylesheet" href="/style.css">
  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>
</head>

<body>
    <div id="loading-bar-wrapper">
  <div id="loading-bar"></div>
</div>


    <script>setLoadingBarProgress(20)</script>
    <header class="l_header">
	<div class='wrapper'>
		<div class="nav-main container container--flex">
			<a class="logo flat-box" href='/' >
				<!-- <i class="fa fa-home"></i> -->
				飞翔的傻瓜
			</a>

				<div class='menu'>
					<ul class='h-list'>
            
    					
    						<li>
    							<a class='nav-about flat-box' href='/'>
    								<i class='fa fa-home fa-'></i>&nbsp;主页
  								</a>
  							</li>
        			
    						<li>
    							<a class='nav-home flat-box' href='/'>
    								<i class='fa fa-rss fa-'></i>&nbsp;博客
  								</a>
  							</li>
        			
    						<li>
    							<a class='nav-archives flat-box' href='/archives'>
    								<i class='fa fa-archive fa-'></i>&nbsp;归档
  								</a>
  							</li>
        			
        		
					</ul>
					<div class='underline'></div>
				</div>

			
				<div class="m_search">
					<form name="searchform" class="form u-search-form">
						<input type="text" class="input u-search-input" placeholder="Search" />
						<span class="icon"><i class="fa fa-search fa-fw"></i></span>
					</form>
				</div>
			
			<ul class='switcher h-list'>
				
					<li class='s-search'><a class="fa fa-search fa-fw" href='javascript:void(0)'></span></a></li>
				
				<li class='s-menu'><a class="fa fa-navicon fa-fw" href='javascript:void(0)'></a></li>
			</ul>
		</div>

		<div class='nav-sub container container--flex'>
			<a class="logo flat-box"></a>
			<ul class='switcher h-list'>
				<li class='s-comment'><a class="fa fa-comments fa-fw flat-box" href='javascript:void(0)'></a></li>
				<li class='s-top'><a class="fa fa-arrow-up fa-fw flat-box" href='javascript:void(0)'></a></li>
				<li class='s-toc'><a class="fa fa-list-ul fa-fw flat-box" href='javascript:void(0)'></a></li>
			</ul>
		</div>
	</div>
</header>
	<aside class="menu-phone">
        <div class="header">飞翔的傻瓜</div>
		<nav>
            <ul>
                
                    
                        <li>
                            <a class='nav-about flat-box nav flat-box' href='/'>
                            <i class='fa fa-home fa-fw'></i>&nbsp;主页</a>
                        </li>
                    
                        <li>
                            <a class='nav-home flat-box nav flat-box' href='/'>
                            <i class='fa fa-rss fa-fw'></i>&nbsp;博客</a>
                        </li>
                    
                        <li>
                            <a class='nav-archives flat-box nav flat-box' href='/archives'>
                            <i class='fa fa-archive fa-fw'></i>&nbsp;归档</a>
                        </li>
                    
             
            </ul>
		</nav>
	</aside>

    <script>setLoadingBarProgress(40);</script>
    <div class="l_body">
    <div class='container clearfix'>
        <div class='l_main'>
            <article id="post-Java验证码图片创建" class="post white-box article-type-post" itemscope itemprop="blogPost">
    <section class='meta'>
        <h1 class="title">
            
                Java验证码图片创建
            
        </h1>
        <time>
            <i class="fa fa-calendar fa-fw" aria-hidden="true"></i>&nbsp;2018-07-29&nbsp;&nbsp;
            <i class="fa fa-eye fa-fw" aria-hidden="true"></i>&nbsp;<span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span>
        </time>
        
    
    <div class='cats'>
        <a href="/categories/Java/">Java</a>
    </div>


    </section>

    <section class="article typo">

        <div class="article-entry" itemprop="articleBody">
            <p>最近需要实现一个验证码生成工具类，之前完全没有接触过Java图形方面的知识，临时上网查阅资料，总结下自己学到的内容，到最后学习实现一个自己可以用的上的工具类,所有参阅的资料都在文末的引用部分。<br><a id="more"></a></p>
<h3 id="java-awt下的Image类与BufferedImage"><a href="#java-awt下的Image类与BufferedImage" class="headerlink" title="java.awt下的Image类与BufferedImage"></a>java.awt下的Image类与BufferedImage</h3><ul>
<li>java.awt.Image ：抽象类Image是表示图形图像的所有类的超类</li>
<li>java.awt.image.BufferedImage 是Image的子类，描述具有可访问图像数据缓冲区的Image</li>
</ul>
<p>总得来说，Image通常用来获取图片，BufferedImage做图片修改操作如大小变换等 </p>
<h3 id="Graphics-与Graphics2D"><a href="#Graphics-与Graphics2D" class="headerlink" title="Graphics 与Graphics2D"></a>Graphics 与Graphics2D</h3><p>Graphics类是所有的图像上下文类的抽象基类，这些图形上下文允许应用程序绘制在各种设备上实现的组件以及屏幕外的图像上。 </p>
<p>图形对象封装了Java支持的基本呈现操作所需的状态信息。</p>
<p>Graphics2D 类扩展 Graphics 类，以提供对几何形状、坐标转换、颜色管理和文本布局更为复杂的控制。它是用于在 Java(tm) 平台上呈现二维形状、文本和图像的基础类</p>
<p><strong>获取Graphics对象</strong></p>
<ul>
<li>通过继承BufferedImage对象实例获得：BufferedImage.createGraphics()/getGraphics();</li>
<li>继承Swing组建的paintComponent(Graphics g)方法</li>
</ul>
<p><strong>转型为Graphics2D 对象</strong></p>
<p>Graphics2D可以通过<code>setRenderingHint(RenderingHints.key,RenderingHints.value)</code>方法是否设置图形反锯齿、文字反锯齿、设置图像的插入方法、绘制方法、是否支持抖动等属性。 </p>
<p><strong>stroke 属性</strong></p>
<p>stroke属性用于控制线条的宽度、笔形样式、线段连接方式或短划线图案。</p>
<p>如果我们要设置stroke属性，则应当先创建Stroke引用的对象，但由于Stroke为接口类型，所以我们要创建对象，可以创建其已知实现类BasicStroke的对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g2d.setStroke(<span class="keyword">new</span> BasicStroke(<span class="keyword">float</span> width,<span class="keyword">int</span> cap,<span class="keyword">int</span> join));</span><br></pre></td></tr></table></figure>
<ul>
<li>width 笔画的宽度</li>
<li>cap 端点的样式</li>
<li>join是两线段交汇的连接方式</li>
</ul>
<p>（具体详细解释请查看文末引用原博主博客）</p>
<p><strong>clip属性</strong></p>
<p>clip属性用于实现剪裁效果。设置剪裁属性可调用如下方法确定剪裁区的Shape</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">setClip</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> width, <span class="keyword">int</span> height)</span></span></span><br></pre></td></tr></table></figure>
<p><strong>paint属性</strong></p>
<p>paint属性控制填充效果，通过调用setPaint()方法设置： 其函数传入对应的Paint对象</p>
<p>注意：</p>
<ul>
<li>paint可以同时作用在边线和填充上，可以是单色，渐变和图案，任何paint都需要实现java.awt.Paint接口 </li>
<li>因为Color类实现了java.awt.Paint接口，所有的Color对象都是Paint对象。 </li>
</ul>
<p>一些特殊的Paint类：</p>
<ul>
<li><p>GradientPaint类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">GradientPaint</span><span class="params">(<span class="keyword">float</span> x1, <span class="keyword">float</span> y1, Color color1,</span></span></span><br><span class="line"><span class="function"><span class="params">                <span class="keyword">float</span> x2, <span class="keyword">float</span> y2, Color color2)</span></span></span><br></pre></td></tr></table></figure>
<p>这个类用颜色渐变填充一个区域，构造函数指定定比例和颜色。图形引擎会从第一个点到第二个点之间线性变化两个颜色：从(x1,y1)到(x2,y2)颜色从c1渐变到c2。我们还可以指定颜色图案是否允许重复。 </p>
</li>
<li><p>TexturePaint类： </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">TexturePaint</span><span class="params">(BufferedImage txtr, Rectangle2D anchor)</span></span></span><br></pre></td></tr></table></figure>
<p>这个类平铺一个图像来填充图形，构造函数接收一个java.awt.image.BufferedImage和一个Rectangle2D，把图像影射到矩形里，然后平铺矩形。</p>
<p>我们可以先创建GradientPaint类或TexturePaint类的对象，再调用Graphics2D的setPaint()方法设置填充效果。</p>
</li>
</ul>
<p><strong>Font属性</strong></p>
<p>所有的文本都使用能表现文字的样式图形渲染。当前的字体决定了字体的形状。使用继承自java.awt.Graphics的getFont()方法和setFont()方法来操纵字体。 </p>
<p><strong>Transform属性</strong></p>
<p>transform属性用来实现常用的图形平移、缩放和斜切等变换操作。我们可以调用setTransform()来设置transform属性：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">setTransform</span><span class="params">(AffineTransform Tx)</span></span></span><br></pre></td></tr></table></figure>
<p>该方法需要一个AffineTransform对象的参数，所以首先创建AffineTransform对象，然后调用setTransform()方法设置transform属性。最后，用具有指定属性的Graphics2D对象绘制图形。</p>
<p>创建AffineTransform对象的方法有：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 旋转变换，旋转theta弧度</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> AffineTransform <span class="title">getRotateInstance</span><span class="params">(<span class="keyword">double</span> theta)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 绕旋转中心(anchorx, anchory)旋转</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> AffineTransform <span class="title">getRotateInstance</span><span class="params">(<span class="keyword">double</span> theta, <span class="keyword">double</span> anchorx,</span></span></span><br><span class="line"><span class="function"><span class="params">                                            <span class="keyword">double</span> anchory)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 缩放变换，x和y方向分别按sx,sy比例变换</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> AffineTransform <span class="title">getScaleInstance</span><span class="params">(<span class="keyword">double</span> sx, <span class="keyword">double</span> sy)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 错切变换，shx和shy指定斜拉度</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> AffineTransform <span class="title">getShearInstance</span><span class="params">(<span class="keyword">double</span> shx, <span class="keyword">double</span> shy)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 平移变换，tx和ty表示x和y方向平移距离</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> AffineTransform <span class="title">getTranslateInstance</span><span class="params">(<span class="keyword">double</span> tx, <span class="keyword">double</span> ty)</span></span></span><br></pre></td></tr></table></figure>
<p>当然，也可以先创建一个没有transform属性的AffineTransform对象，然后用以下方法指定图形平移、旋转、缩放变换属性： </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将图形在x轴方向平移tx像素，y轴方向平移ty像素</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">translate</span><span class="params">(<span class="keyword">double</span> tx, <span class="keyword">double</span> ty)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 旋转theta弧度</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rotate</span><span class="params">(<span class="keyword">double</span> theta)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 图形以点(anchorx, anchory)为轴点，旋转theta弧度</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rotate</span><span class="params">(<span class="keyword">double</span> theta, <span class="keyword">double</span> anchorx, <span class="keyword">double</span> anchory)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 图形在x轴方向缩放sx倍，纵向缩放sy倍</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">scale</span><span class="params">(<span class="keyword">double</span> sx, <span class="keyword">double</span> sy)</span></span></span><br></pre></td></tr></table></figure>
<p><strong>composit属性</strong></p>
<p>composit属性设置图形重叠区域的效果。可通过调用setComposite()方法设置该属性： </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">setComposite</span><span class="params">(Composite comp)</span></span></span><br></pre></td></tr></table></figure>
<p>例如先用方法AlphaComposite.getInstance(int rule, float alpha)得到AlphaComposite对象，再通过setComposite()方法设置混合效果。AlphaComposite在图形和图像中实现混合和透明效果，Alpha值的范围为0.0f(完全透明)-1.0f(完全不透明)。 </p>
<hr>
<h3 id="使用Graphics2D绘图"><a href="#使用Graphics2D绘图" class="headerlink" title="使用Graphics2D绘图"></a>使用Graphics2D绘图</h3><p>Graphics2D类仍然保留Graphics类的绘图方法，同时增加了许多新方法。新方法将几何图形(线段、圆等)作为一个对象来绘制。在java.awt.geom包中声明的一系列类，分别用于创建各种身体图形对象。常用的主要有：</p>
<ul>
<li>Line2D - 线段类</li>
<li>RoundRectangle2D - 圆角矩形类</li>
<li>Ellipse2D - 椭圆类</li>
<li>Arc2D - 圆弧类</li>
<li>QuadCurve2D - 二次曲线类</li>
<li>CubicCurve2D - 三次曲线类。</li>
</ul>
<p>要用Graphics2D类的新方法画一个图形。先在重画方法paintComponent()或paint()中，把参数对象g强制转换成Graphics2D对象；然后，用上述图形类提供的静态内部类构造方法Double()或Float()创建该图形的对象；最后，以图形对象为参数调用Graphics2D对象的draw()方法绘制这个图形。</p>
<p>画一条线段：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 画线 */</span></span><br><span class="line">Stroke s = <span class="keyword">new</span> BasicStroke(<span class="number">20</span>, BasicStroke.CAP_ROUND, BasicStroke.JOIN_MITER);</span><br><span class="line">g2d.setStroke(s);       </span><br><span class="line">Line2D line = <span class="keyword">new</span> Line2D.Double(<span class="number">30</span>,<span class="number">50</span>,<span class="number">100</span>,<span class="number">200</span>);</span><br><span class="line">g2d.draw(line);</span><br><span class="line"><span class="number">123456</span></span><br></pre></td></tr></table></figure>
<p>画一个圆角矩形：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 画圆角矩形 */</span></span><br><span class="line">g2d.setColor(Color.BLUE);</span><br><span class="line">RoundRectangle2D rect = <span class="keyword">new</span> RoundRectangle2D.Double(<span class="number">100</span>, <span class="number">50</span>, <span class="number">100</span>, <span class="number">50</span>,</span><br><span class="line">            <span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">g2d.draw(rect);</span><br><span class="line"><span class="number">123456</span></span><br></pre></td></tr></table></figure>
<p>画一个旋转一定角度的矩形：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 画旋转一定角度的矩形 */</span></span><br><span class="line">Rectangle2D rect2 = <span class="keyword">new</span> Rectangle2D.Double(<span class="number">60</span>, <span class="number">160</span>, <span class="number">60</span>, <span class="number">90</span>);</span><br><span class="line">AffineTransform transform = <span class="keyword">new</span> AffineTransform();</span><br><span class="line">transform.rotate(<span class="number">45</span> * Math.PI / <span class="number">180</span>, <span class="number">90</span>, <span class="number">200</span>); <span class="comment">// 围绕(90,200)点旋转图形45度</span></span><br><span class="line">g2d.setTransform(transform);</span><br><span class="line">g2d.draw(rect2);</span><br></pre></td></tr></table></figure>
<p><strong>消除锯齿</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">g2.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);</span><br><span class="line">g2.setRenderingHint(RenderingHints.KEY_STROKE_CONTROL, RenderingHints.VALUE_STROKE_DEFAULT);</span><br></pre></td></tr></table></figure></p>
<p>注意：绘制完图像后记得用dispose()方法释放资源</p>
<h3 id="验证码生成的实现"><a href="#验证码生成的实现" class="headerlink" title="验证码生成的实现"></a>验证码生成的实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//验证码原实现博主是CSDN的The...Exception的大佬，在这里做了简单的修改以及添加了大量的注释来巩固上面的知识。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.Color;</span><br><span class="line"><span class="keyword">import</span> java.awt.Font;</span><br><span class="line"><span class="keyword">import</span> java.awt.Graphics;</span><br><span class="line"><span class="keyword">import</span> java.awt.Graphics2D;</span><br><span class="line"><span class="keyword">import</span> java.awt.LinearGradientPaint;</span><br><span class="line"><span class="keyword">import</span> java.awt.Paint;</span><br><span class="line"><span class="keyword">import</span> java.awt.RenderingHints;</span><br><span class="line"><span class="keyword">import</span> java.awt.geom.AffineTransform;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VerifyCodeUtils</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="comment">//使用到Algerian字体，系统里没有的话需要安装字体，字体只显示大写，去掉了1,0,i,o几个容易混淆的字符</span></span><br><span class="line">	<span class="comment">//这个也是默认的字符源</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String VERIFY_CODES = <span class="string">"23456789ABCDEFGHJKLMNPQRSTUVWXYZ"</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Random random = <span class="keyword">new</span> Random();</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 使用系统默认字符源生成验证码</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> verifySize	验证码长度</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">generateVerifyCode</span><span class="params">(<span class="keyword">int</span> verifySize)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> generateVerifyCode(verifySize, VERIFY_CODES);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 使用指定源生成验证码</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> verifySize	验证码长度</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> sources	验证码字符源</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">generateVerifyCode</span><span class="params">(<span class="keyword">int</span> verifySize, String sources)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(sources == <span class="keyword">null</span> || sources.length() == <span class="number">0</span>)&#123;</span><br><span class="line">			sources = VERIFY_CODES;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> codesLen = sources.length();</span><br><span class="line">		<span class="comment">//用当前时间作为随机生成种子在一定程度上达到了真随机</span></span><br><span class="line">		Random rand = <span class="keyword">new</span> Random(System.currentTimeMillis());</span><br><span class="line">		<span class="comment">//使用StringBuilder做到不断的附加随机字符</span></span><br><span class="line">		StringBuilder verifyCode = <span class="keyword">new</span> StringBuilder(verifySize);</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; verifySize; i++)&#123;</span><br><span class="line">			verifyCode.append(sources.charAt(rand.nextInt(codesLen-<span class="number">1</span>)));</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> verifyCode.toString();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 生成随机验证码文件,并返回验证码值</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> w</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> h</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> outputFile</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> verifySize</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">outputVerifyImage</span><span class="params">(<span class="keyword">int</span> w, <span class="keyword">int</span> h, File outputFile, <span class="keyword">int</span> verifySize)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">		String verifyCode = generateVerifyCode(verifySize);</span><br><span class="line">		outputImage(w, h, outputFile, verifyCode);</span><br><span class="line">		<span class="keyword">return</span> verifyCode;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 输出随机验证码图片流,并返回验证码值</span></span><br><span class="line"><span class="comment">	 * 先生成具体的随机验证码，再去生成对应的图片</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> w</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> h</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> os</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> verifySize</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">outputVerifyImage</span><span class="params">(<span class="keyword">int</span> w, <span class="keyword">int</span> h, OutputStream os, <span class="keyword">int</span> verifySize)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">		String verifyCode = generateVerifyCode(verifySize);</span><br><span class="line">		outputImage(w, h, os, verifyCode);</span><br><span class="line">		<span class="keyword">return</span> verifyCode;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 生成指定验证码图像文件</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> w</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> h</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> outputFile</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> code</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="comment">//生成图片保存的位置,抛出异常通知上层</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">outputImage</span><span class="params">(<span class="keyword">int</span> w, <span class="keyword">int</span> h, File outputFile, String code)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">		<span class="comment">//没有输出文件的情况下先退出</span></span><br><span class="line">		<span class="keyword">if</span>(outputFile == <span class="keyword">null</span>)&#123;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//由于File中的路径直接使用mkDir生成的都是文件夹，因此需要先找到父文件夹先判断生成文件夹</span></span><br><span class="line">		File dir = outputFile.getParentFile();</span><br><span class="line">		<span class="keyword">if</span>(!dir.exists())&#123;</span><br><span class="line">			dir.mkdirs();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//再去生成具体的文件</span></span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			outputFile.createNewFile();</span><br><span class="line">			FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(outputFile);</span><br><span class="line">			outputImage(w, h, fos, code);</span><br><span class="line">			fos.close();</span><br><span class="line">		&#125; <span class="keyword">catch</span>(IOException e)&#123;</span><br><span class="line">			<span class="keyword">throw</span> e;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 输出指定验证码图片流</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> w</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> h</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> os</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> code</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">outputImage</span><span class="params">(<span class="keyword">int</span> w, <span class="keyword">int</span> h, OutputStream os, String code)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">		<span class="keyword">int</span> verifySize = code.length();</span><br><span class="line">		<span class="comment">//创建BufferedImage</span></span><br><span class="line">		BufferedImage image = <span class="keyword">new</span> BufferedImage(w, h, BufferedImage.TYPE_INT_RGB);</span><br><span class="line">		Random rand = <span class="keyword">new</span> Random();</span><br><span class="line">		<span class="comment">//获取Graphics2D对象</span></span><br><span class="line">		Graphics2D g2 = image.createGraphics();</span><br><span class="line">		<span class="comment">//设置抗锯齿</span></span><br><span class="line">		g2.setRenderingHint(RenderingHints.KEY_ANTIALIASING,RenderingHints.VALUE_ANTIALIAS_ON);</span><br><span class="line">		<span class="comment">//Colors数组</span></span><br><span class="line">		Color[] colors = <span class="keyword">new</span> Color[<span class="number">5</span>];</span><br><span class="line">		<span class="comment">//ColorSpaces数组</span></span><br><span class="line">		Color[] colorSpaces = <span class="keyword">new</span> Color[] &#123; Color.WHITE, Color.CYAN,</span><br><span class="line">				Color.GRAY, Color.LIGHT_GRAY, Color.MAGENTA, Color.ORANGE,</span><br><span class="line">				Color.PINK, Color.YELLOW &#125;;</span><br><span class="line">		<span class="keyword">float</span>[] fractions = <span class="keyword">new</span> <span class="keyword">float</span>[colors.length];</span><br><span class="line">		<span class="comment">//随机从ColorSpace找到五种颜色和五个</span></span><br><span class="line">		<span class="comment">//TODO </span></span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; colors.length; i++)&#123;</span><br><span class="line">			colors[i] = colorSpaces[rand.nextInt(colorSpaces.length)];</span><br><span class="line">			fractions[i] = rand.nextFloat();</span><br><span class="line">		&#125;</span><br><span class="line">		Arrays.sort(fractions);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//绘制背景，之后只保留一部分，所以是绘制边框</span></span><br><span class="line">		g2.setColor(Color.GRAY);<span class="comment">// 设置边框色</span></span><br><span class="line">		g2.fillRect(<span class="number">0</span>, <span class="number">0</span>, w, h);</span><br><span class="line">		</span><br><span class="line">		Color c = getRandColor(<span class="number">200</span>, <span class="number">250</span>);</span><br><span class="line">		g2.setColor(c);<span class="comment">// 设置背景色</span></span><br><span class="line">		g2.fillRect(<span class="number">0</span>, <span class="number">2</span>, w, h-<span class="number">4</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//绘制干扰线</span></span><br><span class="line">		Random random = <span class="keyword">new</span> Random();</span><br><span class="line">		g2.setColor(getRandColor(<span class="number">160</span>, <span class="number">200</span>));<span class="comment">// 设置线条的颜色</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">			<span class="keyword">int</span> x = random.nextInt(w - <span class="number">1</span>);</span><br><span class="line">			<span class="keyword">int</span> y = random.nextInt(h - <span class="number">1</span>);</span><br><span class="line">			<span class="keyword">int</span> xl = random.nextInt(<span class="number">6</span>) + <span class="number">1</span>;</span><br><span class="line">			<span class="keyword">int</span> yl = random.nextInt(<span class="number">12</span>) + <span class="number">1</span>;</span><br><span class="line">			g2.drawLine(x, y, x + xl + <span class="number">40</span>, y + yl + <span class="number">20</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 添加噪点</span></span><br><span class="line">		<span class="keyword">float</span> yawpRate = <span class="number">0.05f</span>;<span class="comment">// 噪声率</span></span><br><span class="line">		<span class="keyword">int</span> area = (<span class="keyword">int</span>) (yawpRate * w * h);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; area; i++) &#123;</span><br><span class="line">			<span class="keyword">int</span> x = random.nextInt(w);</span><br><span class="line">			<span class="keyword">int</span> y = random.nextInt(h);</span><br><span class="line">			<span class="keyword">int</span> rgb = getRandomIntColor();</span><br><span class="line">			image.setRGB(x, y, rgb);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		shear(g2, w, h, c);<span class="comment">// 使图片扭曲</span></span><br><span class="line">		<span class="comment">//设置字体颜色</span></span><br><span class="line">		g2.setColor(getRandColor(<span class="number">100</span>, <span class="number">160</span>));</span><br><span class="line">		<span class="keyword">int</span> fontSize = h-<span class="number">4</span>;</span><br><span class="line">		Font font = <span class="keyword">new</span> Font(<span class="string">"Algerian"</span>, Font.ITALIC, fontSize);</span><br><span class="line">		g2.setFont(font);</span><br><span class="line">		<span class="keyword">char</span>[] chars = code.toCharArray();</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; verifySize; i++)&#123;</span><br><span class="line">			AffineTransform affine = <span class="keyword">new</span> AffineTransform();</span><br><span class="line">			affine.setToRotation(Math.PI / <span class="number">4</span> * rand.nextDouble() * (rand.nextBoolean() ? <span class="number">1</span> : -<span class="number">1</span>), (w / verifySize) * i + fontSize/<span class="number">2</span>, h/<span class="number">2</span>);</span><br><span class="line">			g2.setTransform(affine);</span><br><span class="line">			g2.drawChars(chars, i, <span class="number">1</span>, ((w-<span class="number">10</span>) / verifySize) * i + <span class="number">5</span>, h/<span class="number">2</span> + fontSize/<span class="number">2</span> - <span class="number">10</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//清除</span></span><br><span class="line">		g2.dispose();</span><br><span class="line">		ImageIO.write(image, <span class="string">"jpg"</span>, os);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//生成一个随机的颜色，在bc-fc是其RGB分量的范围</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Color <span class="title">getRandColor</span><span class="params">(<span class="keyword">int</span> fc, <span class="keyword">int</span> bc)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//对输入参数进行过滤</span></span><br><span class="line">		<span class="keyword">if</span> (fc &gt; <span class="number">255</span>)</span><br><span class="line">			fc = <span class="number">255</span>;</span><br><span class="line">		<span class="keyword">if</span> (bc &gt; <span class="number">255</span>)</span><br><span class="line">			bc = <span class="number">255</span>;</span><br><span class="line">		<span class="keyword">int</span> r = fc + random.nextInt(bc - fc);</span><br><span class="line">		<span class="keyword">int</span> g = fc + random.nextInt(bc - fc);</span><br><span class="line">		<span class="keyword">int</span> b = fc + random.nextInt(bc - fc);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Color(r, g, b);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//用int类型值去保存RGB三个分量，这里用到左移，之后用逻辑加进行处理</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getRandomIntColor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span>[] rgb = getRandomRgb();</span><br><span class="line">		<span class="keyword">int</span> color = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> c : rgb) &#123;</span><br><span class="line">			color = color &lt;&lt; <span class="number">8</span>;</span><br><span class="line">			color = color | c;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> color;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//生成随机颜色，RGB分量由数组保存</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span>[] getRandomRgb() &#123;</span><br><span class="line">		<span class="keyword">int</span>[] rgb = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">3</span>];</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">			rgb[i] = random.nextInt(<span class="number">255</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> rgb;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">shear</span><span class="params">(Graphics g, <span class="keyword">int</span> w1, <span class="keyword">int</span> h1, Color color)</span> </span>&#123;</span><br><span class="line">		shearX(g, w1, h1, color);</span><br><span class="line">		shearY(g, w1, h1, color);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">shearX</span><span class="params">(Graphics g, <span class="keyword">int</span> w1, <span class="keyword">int</span> h1, Color color)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">		<span class="keyword">int</span> period = random.nextInt(<span class="number">2</span>);</span><br><span class="line"> </span><br><span class="line">		<span class="keyword">boolean</span> borderGap = <span class="keyword">true</span>;</span><br><span class="line">		<span class="keyword">int</span> frames = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">int</span> phase = random.nextInt(<span class="number">2</span>);</span><br><span class="line"> </span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; h1; i++) &#123;</span><br><span class="line">			<span class="keyword">double</span> d = (<span class="keyword">double</span>) (period &gt;&gt; <span class="number">1</span>)</span><br><span class="line">					* Math.sin((<span class="keyword">double</span>) i / (<span class="keyword">double</span>) period</span><br><span class="line">							+ (<span class="number">6.2831853071795862</span>D * (<span class="keyword">double</span>) phase)</span><br><span class="line">							/ (<span class="keyword">double</span>) frames);</span><br><span class="line">			g.copyArea(<span class="number">0</span>, i, w1, <span class="number">1</span>, (<span class="keyword">int</span>) d, <span class="number">0</span>);</span><br><span class="line">			<span class="keyword">if</span> (borderGap) &#123;</span><br><span class="line">				g.setColor(color);</span><br><span class="line">				g.drawLine((<span class="keyword">int</span>) d, i, <span class="number">0</span>, i);</span><br><span class="line">				g.drawLine((<span class="keyword">int</span>) d + w1, i, w1, i);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"> </span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">shearY</span><span class="params">(Graphics g, <span class="keyword">int</span> w1, <span class="keyword">int</span> h1, Color color)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">		<span class="keyword">int</span> period = random.nextInt(<span class="number">40</span>) + <span class="number">10</span>; <span class="comment">// 50;</span></span><br><span class="line"> </span><br><span class="line">		<span class="keyword">boolean</span> borderGap = <span class="keyword">true</span>;</span><br><span class="line">		<span class="keyword">int</span> frames = <span class="number">20</span>;</span><br><span class="line">		<span class="keyword">int</span> phase = <span class="number">7</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; w1; i++) &#123;</span><br><span class="line">			<span class="keyword">double</span> d = (<span class="keyword">double</span>) (period &gt;&gt; <span class="number">1</span>)</span><br><span class="line">					* Math.sin((<span class="keyword">double</span>) i / (<span class="keyword">double</span>) period</span><br><span class="line">							+ (<span class="number">6.2831853071795862</span>D * (<span class="keyword">double</span>) phase)</span><br><span class="line">							/ (<span class="keyword">double</span>) frames);</span><br><span class="line">			g.copyArea(i, <span class="number">0</span>, <span class="number">1</span>, h1, <span class="number">0</span>, (<span class="keyword">int</span>) d);</span><br><span class="line">			<span class="keyword">if</span> (borderGap) &#123;</span><br><span class="line">				g.setColor(color);</span><br><span class="line">				g.drawLine(i, (<span class="keyword">int</span>) d, i, <span class="number">0</span>);</span><br><span class="line">				g.drawLine(i, (<span class="keyword">int</span>) d + h1, i, h1);</span><br><span class="line">			&#125;</span><br><span class="line"> </span><br><span class="line">		&#125;</span><br><span class="line"> </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">		File dir = <span class="keyword">new</span> File(<span class="string">"verifies"</span>);</span><br><span class="line">		<span class="keyword">int</span> w = <span class="number">200</span>, h = <span class="number">80</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50</span>; i++)&#123;</span><br><span class="line">			String verifyCode = generateVerifyCode(<span class="number">4</span>);</span><br><span class="line">			File file = <span class="keyword">new</span> File(dir, verifyCode + <span class="string">".jpg"</span>);</span><br><span class="line">			outputImage(w, h, file, verifyCode);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>参考资料：</p>
<p><a href="https://bbs.csdn.net/topics/250022320" target="_blank" rel="noopener">https://bbs.csdn.net/topics/250022320</a> </p>
<p>BufferedImage与Buffer的区别</p>
<p><a href="https://docs.oracle.com/javase/7/docs/api/java/awt/Graphics.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/7/docs/api/java/awt/Graphics.html</a></p>
<p>Graphics文档</p>
<p><a href="https://blog.csdn.net/zlxtk/article/details/53995049" target="_blank" rel="noopener">https://blog.csdn.net/zlxtk/article/details/53995049</a></p>
<p>Java Graphics初探</p>
<p><a href="https://blog.csdn.net/zhliro/article/details/45645569" target="_blank" rel="noopener">https://blog.csdn.net/zhliro/article/details/45645569</a></p>
<p>Java Graphics2D类的绘图方法</p>
<p><a href="https://blog.csdn.net/ruixue0117/article/details/22829557" target="_blank" rel="noopener">https://blog.csdn.net/ruixue0117/article/details/22829557</a></p>
<p>Java生成验证码</p>
</blockquote>

        </div>

        
            <div class="article-tags tags">
                
                    <a href="/tags/Java/"><i class="fa fa-tag fa-fw" aria-hidden="true"></i>&nbsp;Java</a>
                
            </div>
        

        
            <div class="prev-next">
                
                    <section class="prev" >
                        <span class="art-item-left">
                            <h6><i class="fa fa-chevron-left" aria-hidden="true"></i>&nbsp;上一篇</h6>
                            <h4>
                                <a href="/2018/08/01/js-1/" rel="prev" title="蛋疼的JavaScript(一)：作用域与闭包">
                                  
                                      蛋疼的JavaScript(一)：作用域与闭包
                                  
                                </a>
                            </h4>
                            
                                <h6 class="tags">
                                    
                                        <i class="fa fa-tag fa-fw"></i>JavaScript
                                    
                                </h6>
                            
                        </span>
                    </section>
                
                
                    <section class="next">
                        <span class="art-item-right" aria-hidden="true">
                            <h6>下一篇&nbsp;<i class="fa fa-chevron-right" aria-hidden="true"></i></h6>
                            <h4>
                                <a href="/2018/07/29/动态规划入门/" rel="prev" title="动态规划入门">
                                    
                                        动态规划入门
                                    
                                </a>
                            </h4>
                            
                                <h6 class="tags">
                                    
                                        <i class="fa fa-tag fa-fw"></i>算法
                                    
                                </h6>
                            
                        </span>
                    </section>
                
            </div>
        

    </section>

</article>

<br>

<!-- 显示推荐文章和评论 -->

    <article class="post white-box comments">
        <section class="article typo">

            
                

    <div class="recommended_posts">
        <h4><i class="fa fa-bookmark fa-fw" aria-hidden="true"></i>&nbsp;你可能感兴趣的文章</h4>
        <ul>
            
                <li><a href="http://www.maoxin.site/2018/08/05/ClassLoader总结/">ClassLoader总结</a></li>
            
                <li><a href="http://www.maoxin.site/2018/08/01/js-1/">蛋疼的JavaScript(一)：作用域与闭包</a></li>
            
                <li><a href="http://www.maoxin.site/2018/07/29/动态规划入门/">动态规划入门</a></li>
            
                <li><a href="http://www.maoxin.site/2018/07/28/Windows进程的创建过程/">Windows进程的创建过程</a></li>
            
                <li><a href="http://www.maoxin.site/2018/07/27/Linux 学习（命令）/">Linux学习（命令）</a></li>
            
        </ul>
    </div>


            

            

                

                

                
                    
                        <h4><i class="fa fa-comments fa-fw" aria-hidden="true"></i>&nbsp;Valine评论</h4>
                        <div class="subtitle">
                          <h6><b>文明评论，请勿灌水。</b>为了便于区分，请您在留言时至少填写一下 <b>昵称</b> 啊。<br>
                          与主题相关的内容及评论测试请到 <a href="https://xaoxuu.com/wiki/material-x/">https://xaoxuu.com/wiki/material-x/</a> 留言，
                          
                          留言时填写邮箱可以在被回复时收到邮件提醒，也可以显示Gravatar头像，网址填写个人主页或者博客的作用是别人点击你的昵称会跳转到你的博客，为你增加访问量。</h6>
                        <div>
                        <section id="comments">
                            <div id="valine_container" class="valine_thread">
                                </i><i class="fa fa-spinner fa-spin fa-fw"></i>
                            </div>
                        </section>
                        <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
                        <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
                    
                
            

        </section>
    </article>


<script>
    window.subData = {
        title: 'Java验证码图片创建',
        tools: true
    }
</script>


        </div>
        <aside class='l_side'>
            
    
        
    <section class='m_widget author'>
        
            <div class='header'>
                <img class='avatar' src='http://www.yangshuai.net/wp-content/uploads/2012/01/812.jpg' />
            </div>
        
        
            <div class='content'>
                
                    <h2>飞翔的傻瓜</h2>
                
                
                    <div>
                        <i class="fa fa-quote-left fa-3x fa-pull-left" aria-hidden="true"></i>
                        一分辛苦一分才
                    </div>
                
            </div>
        
        
    </section>


    
    
        <section class='m_widget categories'>
    <div class='header'><i class="fa fa-sitemap fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;分类</div>
    <div class='content'>
        
            <ul class="entry">
                
                    <li><a class="flat-box" href="/categories/C-C/"><div class='name'>C/C++</div><div class='badge'>1</div></a></li>
                
                    <li><a class="flat-box" href="/categories/Java/"><div class='name'>Java</div><div class='badge'>10</div></a></li>
                
                    <li><a class="flat-box" href="/categories/JavaScript/"><div class='name'>JavaScript</div><div class='badge'>8</div></a></li>
                
                    <li><a class="flat-box" href="/categories/Tools/"><div class='name'>Tools</div><div class='badge'>1</div></a></li>
                
                    <li><a class="flat-box" href="/categories/操作系统/"><div class='name'>操作系统</div><div class='badge'>6</div></a></li>
                
                    <li><a class="flat-box" href="/categories/算法/"><div class='name'>算法</div><div class='badge'>3</div></a></li>
                
                    <li><a class="flat-box" href="/categories/计算机网络/"><div class='name'>计算机网络</div><div class='badge'>2</div></a></li>
                
                    <li><a class="flat-box" href="/categories/设计模式/"><div class='name'>设计模式</div><div class='badge'>4</div></a></li>
                
            </ul>
        
    </div>
</section>

    
    
        
    <section class='m_widget tagcloud'>
        <div class="header"><i class="fa fa-tags fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;标签</div>
        <div class='content'>
            <a href="/tags/C/" style="font-size: 14px; color: #999">C</a> <a href="/tags/ClassLoader/" style="font-size: 14px; color: #999">ClassLoader</a> <a href="/tags/Git/" style="font-size: 14px; color: #999">Git</a> <a href="/tags/HTTP协议/" style="font-size: 17.33px; color: #828282">HTTP协议</a> <a href="/tags/Java/" style="font-size: 24px; color: #555">Java</a> <a href="/tags/Java-Servlet/" style="font-size: 14px; color: #999">Java Servlet</a> <a href="/tags/JavaScript/" style="font-size: 24px; color: #555">JavaScript</a> <a href="/tags/Linux/" style="font-size: 17.33px; color: #828282">Linux</a> <a href="/tags/NIO/" style="font-size: 14px; color: #999">NIO</a> <a href="/tags/Server杂项/" style="font-size: 14px; color: #999">Server杂项</a> <a href="/tags/Spring框架学习/" style="font-size: 14px; color: #999">Spring框架学习</a> <a href="/tags/Windows/" style="font-size: 14px; color: #999">Windows</a> <a href="/tags/jdbc/" style="font-size: 14px; color: #999">jdbc</a> <a href="/tags/保护模式/" style="font-size: 14px; color: #999">保护模式</a> <a href="/tags/前端/" style="font-size: 14px; color: #999">前端</a> <a href="/tags/反射/" style="font-size: 14px; color: #999">反射</a> <a href="/tags/操作系统/" style="font-size: 20.67px; color: #6c6c6c">操作系统</a> <a href="/tags/栈-队列-算法/" style="font-size: 14px; color: #999">栈 队列 算法</a> <a href="/tags/注解/" style="font-size: 14px; color: #999">注解</a> <a href="/tags/算法/" style="font-size: 14px; color: #999">算法</a> <a href="/tags/算法-递归/" style="font-size: 14px; color: #999">算法 递归</a> <a href="/tags/设计模式/" style="font-size: 14px; color: #999">设计模式</a> <a href="/tags/设计模式-动态代理/" style="font-size: 14px; color: #999">设计模式 动态代理</a> <a href="/tags/设计模式-策略模式/" style="font-size: 14px; color: #999">设计模式 策略模式</a> <a href="/tags/设计模式-观察者模式/" style="font-size: 14px; color: #999">设计模式 观察者模式</a>
        </div>
    </section>


    
    
        <section class='m_widget music'>
    <div class='header'><i class="fa fa-headphones fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;音乐</div>
    <div class='content'>
        <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=100% height=450 src="//music.163.com/outchain/player?type=0&id=2494951909&auto=0&height=450"></iframe>
    </div>
</section>

    
    
        <section class='m_widget links'>
    <div class='header'><i class="fa fa-handshake-o fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;友链</div>
    <div class='content'>
        <ul class="entry" id="links">
            
                <li><a class="flat-box" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.codergzw.com">
                    <div class='name'>
                        <i class="fa fa-user-circle-o fa-fw" aria-hidden="true"></i>
                        &nbsp;&nbsp;GuoZW的博客
                    </div>
                </a></li>
            
                <li><a class="flat-box" target="_blank" rel="external nofollow noopener noreferrer" href="http://codermiya.com/">
                    <div class='name'>
                        <i class="fa fa-user-circle-o fa-fw" aria-hidden="true"></i>
                        &nbsp;&nbsp;Miyang的博客
                    </div>
                </a></li>
            
            

        </ul>

    </div>
</section>

    
    
        
    <section class='m_widget toc-wrapper'>
        <div class="header"><i class="fa fa-list fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;目录</div>
        <div class='content'>
            <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#java-awt下的Image类与BufferedImage"><span class="toc-text">java.awt下的Image类与BufferedImage</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Graphics-与Graphics2D"><span class="toc-text">Graphics 与Graphics2D</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用Graphics2D绘图"><span class="toc-text">使用Graphics2D绘图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#验证码生成的实现"><span class="toc-text">验证码生成的实现</span></a></li></ol>
        </div>
    </section>


    


        </aside>
        <script>setLoadingBarProgress(60);</script>
    </div>
    </div>
    <footer id="footer" class="clearfix">
    
        <div class="social-wrapper">
          
              
                  <a href="mailto:lumaoxin@aliyun.com" class="social fa fa-envelope flat-box" target="_blank" rel="external"></a>
              
          
              
                  <a href="https://github.com/pickdream" class="social fa fa-github flat-box" target="_blank" rel="external"></a>
              
          
              
          
              
          
              
          
              
                  <a href="atom" class="social fa fa-rss flat-box" target="_blank" rel="external"></a>
              
          
              
          
              
          
              
          
              
          
              
          
              
          
              
          
              
          
              
          
              
          
              
          
              
          
        </div>
    
    <br>
    <div>博客内容遵循 <a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="licenses">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></div>
    <div>本站使用 <a href="https://xaoxuu.com/wiki/material-x/" target="_blank" class="codename">Material X</a> 作为主题，
		总访问量为 <span id="busuanzi_value_site_pv"><i class="fa fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span> 次。
    </div>
</footer>
<!-- 根据页面mathjax变量决定是否加载MathJax数学公式js -->


    <script>setLoadingBarProgress(80);</script>
    <script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src='//cdn.bootcss.com/node-waves/0.7.5/waves.min.js'></script>
<script src="//cdn.bootcss.com/scrollReveal.js/3.3.2/scrollreveal.min.js"></script>
<!-- 访问统计 -->
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


<script src="/js/jquery.fitvids.js"></script>

    <script>
        var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
        var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
        var ALGOLIA_API_KEY = "";
        var ALGOLIA_APP_ID = "";
        var ALGOLIA_INDEX_NAME = "";
        var AZURE_SERVICE_NAME = "";
        var AZURE_INDEX_NAME = "";
        var AZURE_QUERY_KEY = "";
        var BAIDU_API_ID = "";
        var SEARCH_SERVICE = "hexo" || "hexo";
        var ROOT = "/"||"/";
        if(!ROOT.endsWith('/'))ROOT += '/';
    </script>

<script src="/js/search.js"></script>
<script src="/js/app.js"></script>


    
    
    
        
            <script>
            var GUEST_INFO = ['nick','mail','link'];
            var guest_info = 'nick,mail'.split(',').filter(function(item){
                return GUEST_INFO.indexOf(item) > -1
            });
            var notify = 'false' == true;
            var verify = 'false' == true;
            var valine = new Valine();
            valine.init({
                el: '#valine_container',
                notify: notify,
                verify: verify,
                guest_info: guest_info,
                appId: "pgBuSBODle0hjwgalrOvPfU4-gzGzoHsz",
                appKey: "3yMl5NERDDSPcl1nAu2kp2v1",
                placeholder: "快来评论吧~",
                pageSize:'5',
                avatar:'mp',
                lang:'zh-cn'
            })
            </script>
        
    


    <script>setLoadingBarProgress(100);</script>
</body>
